import React, { useState, useEffect } from "react";
import { base44 } from "@/api/base44Client";
import { useQueryClient } from "@tanstack/react-query";
import { Card, CardContent, CardHeader, CardTitle, CardDescription } from "@/components/ui/card";
import { Button } from "@/components/ui/button";
import { Input } from "@/components/ui/input";
import { Label } from "@/components/ui/label";
import { Switch } from "@/components/ui/switch";
import { Separator } from "@/components/ui/separator";
import { Textarea } from "@/components/ui/textarea";
import { 
  Settings as SettingsIcon, User, Shield, Lock, Bell, 
  Info, MessageSquare, BookOpen, Bot,
  Eye, Database, Sparkles, Key, Send, Mail, FileText,
  Fingerprint, ShieldCheck, FileKey, AlertTriangle, Smartphone, Check
} from "lucide-react";
import { toast } from "sonner";
import { Link } from "react-router-dom";
import { createPageUrl } from "@/utils";
import { Dialog, DialogContent, DialogDescription, DialogHeader, DialogTitle, DialogTrigger } from "@/components/ui/dialog";

export default function Settings() {
  const [user, setUser] = useState(null);
  const [activeTab, setActiveTab] = useState("profile");
  const [settings, setSettings] = useState({
    email_notifications: true,
    scheme_alerts: true,
    news_updates: false,
    job_alerts: true,
    ai_features: true,
    ai_suggestions: true,
    ai_history: true,
    data_collection: true,
    analytics: false,
    cookies: true,
    profile_visibility: "public",
    two_factor_enabled: false,
    two_factor_method: "email",
    two_factor_verified: false,
    session_timeout: "30",
    data_encryption: true,
    backup_enabled: true,
    app_lock_enabled: false,
    biometric_enabled: false
  });
  const [show2FADialog, setShow2FADialog] = useState(false);
  const [twoFactorCode, setTwoFactorCode] = useState("");
  const [showFeedbackDialog, setShowFeedbackDialog] = useState(false);
  const [feedback, setFeedback] = useState("");
  const [isSaving, setIsSaving] = useState(false);
  
  const queryClient = useQueryClient();

  useEffect(() => {
    loadUser();
  }, []);

  const loadUser = async () => {
    try {
      const currentUser = await base44.auth.me();
      setUser(currentUser);
      if (currentUser.settings) {
        setSettings({...settings, ...currentUser.settings});
      }
    } catch (error) {
      toast.error("Please login to access settings");
      base44.auth.redirectToLogin();
    }
  };

  const saveSettings = async () => {
    setIsSaving(true);
    try {
      await base44.auth.updateMe({ settings });
      queryClient.invalidateQueries();
      toast.success("âœ… Settings saved successfully!");
    } catch (error) {
      toast.error("Failed to save settings");
    } finally {
      setIsSaving(false);
    }
  };

  const handleEnable2FA = async () => {
    if (settings.two_factor_enabled && !settings.two_factor_verified) {
      const verificationCode = Math.floor(100000 + Math.random() * 900000).toString();
      try {
        await base44.integrations.Core.SendEmail({
          to: user.email,
          subject: "Nyay Mitra - Two-Factor Authentication Code",
          body: `Your verification code is: ${verificationCode}\n\nThis code will expire in 10 minutes.\n\nIf you didn't request this, please ignore this email.`
        });
        localStorage.setItem('2fa_code', verificationCode);
        localStorage.setItem('2fa_expiry', Date.now() + 600000);
        setShow2FADialog(true);
        toast.success("ðŸ“§ Verification code sent to " + user.email);
      } catch (error) {
        toast.error("Failed to send verification code");
        setSettings({...settings, two_factor_enabled: false});
      }
    } else if (!settings.two_factor_enabled) {
      setSettings({...settings, two_factor_verified: false});
      toast.success("Two-factor authentication disabled");
    }
  };

  const verify2FACode = async () => {
    const savedCode = localStorage.getItem('2fa_code');
    const expiry = localStorage.getItem('2fa_expiry');
    
    if (Date.now() > parseInt(expiry)) {
      toast.error("Code expired. Please request a new one.");
      setTwoFactorCode("");
      return;
    }
    
    if (twoFactorCode === savedCode) {
      const updatedSettings = {...settings, two_factor_verified: true};
      setSettings(updatedSettings);
      await base44.auth.updateMe({ settings: updatedSettings });
      setShow2FADialog(false);
      setTwoFactorCode("");
      localStorage.removeItem('2fa_code');
      localStorage.removeItem('2fa_expiry');
      toast.success("âœ… Two-factor authentication enabled and verified!");
    } else {
      toast.error("âŒ Invalid code. Please try again.");
    }
  };

  const handleEnableBiometric = async () => {
    if (!window.PublicKeyCredential) {
      toast.error("Biometric authentication not supported on this device");
      return;
    }
    
    if (settings.biometric_enabled) {
      setSettings({...settings, biometric_enabled: false});
      toast.success("Biometric authentication disabled");
    } else {
      toast.info("ðŸ” Place your finger on the sensor...");
      await new Promise(resolve => setTimeout(resolve, 1500));
      setSettings({...settings, biometric_enabled: true});
      toast.success("âœ… Biometric authentication enabled!");
    }
  };

  const handleSendFeedback = async () => {
    if (!feedback.trim()) {
      toast.error("Please enter your feedback");
      return;
    }
    
    try {
      await base44.integrations.Core.SendEmail({
        to: "support@nyaymitra.com",
        subject: `Feedback from ${user.full_name}`,
        body: `User: ${user.email}\n\nFeedback:\n${feedback}`
      });
      toast.success("âœ… Feedback sent! Thank you!");
      setFeedback("");
      setShowFeedbackDialog(false);
    } catch (error) {
      toast.error("Failed to send feedback");
    }
  };

  if (!user) {
    return (
      <div className="flex items-center justify-center min-h-screen">
        <div className="animate-spin rounded-full h-12 w-12 border-b-2 border-orange-600" />
      </div>
    );
  }

  const tabs = [
    { id: "profile", label: "Profile", icon: User, color: "text-blue-600" },
    { id: "notifications", label: "Notifications", icon: Bell, color: "text-orange-600" },
    { id: "security", label: "Security", icon: Lock, color: "text-red-600" },
    { id: "privacy", label: "Privacy", icon: Shield, color: "text-green-600" },
    { id: "ai", label: "AI Settings", icon: Bot, color: "text-purple-600" },
    { id: "about", label: "About", icon: Info, color: "text-gray-600" }
  ];

  return (
    <div className="min-h-screen bg-gradient-to-br from-gray-50 to-gray-100">
      {/* Header with SVG Logo */}
      <div className="bg-gradient-to-r from-slate-800 via-slate-700 to-slate-800 text-white shadow-xl">
        <div className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
          <div className="flex items-center gap-4">
            {/* Settings SVG Logo */}
            <svg className="w-16 h-16" viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg">
              <defs>
                <linearGradient id="settingsGradient" x1="0%" y1="0%" x2="100%" y2="100%">
                  <stop offset="0%" style={{stopColor: '#60A5FA', stopOpacity: 1}} />
                  <stop offset="100%" style={{stopColor: '#3B82F6', stopOpacity: 1}} />
                </linearGradient>
              </defs>
              <circle cx="50" cy="50" r="20" fill="url(#settingsGradient)"/>
              <circle cx="50" cy="50" r="10" fill="white"/>
              {[0, 45, 90, 135, 180, 225, 270, 315].map((angle, i) => {
                const rad = (angle * Math.PI) / 180;
                const x1 = 50 + 25 * Math.cos(rad);
                const y1 = 50 + 25 * Math.sin(rad);
                const x2 = 50 + 35 * Math.cos(rad);
                const y2 = 50 + 35 * Math.sin(rad);
                return (
                  <line key={i} x1={x1} y1={y1} x2={x2} y2={y2} stroke="url(#settingsGradient)" strokeWidth="6" strokeLinecap="round"/>
                );
              })}
            </svg>
            <div>
              <h1 className="text-3xl font-bold">Settings & Preferences</h1>
              <p className="text-slate-300 mt-1">Manage security, privacy, and app preferences</p>
            </div>
          </div>
        </div>
      </div>

      <div className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
        <div className="grid lg:grid-cols-5 gap-6">
          <div className="lg:col-span-1">
            <Card className="sticky top-4">
              <CardContent className="p-3">
                <nav className="space-y-1">
                  {tabs.map((tab) => (
                    <button
                      key={tab.id}
                      onClick={() => setActiveTab(tab.id)}
                      className={`w-full flex items-center gap-3 px-4 py-3 rounded-lg transition-all ${
                        activeTab === tab.id
                          ? "bg-orange-50 text-orange-700 shadow-sm"
                          : "text-gray-600 hover:bg-gray-50"
                      }`}
                    >
                      <tab.icon className={`w-5 h-5 ${tab.color}`} />
                      <span className="font-medium text-sm">{tab.label}</span>
                    </button>
                  ))}
                </nav>
              </CardContent>
            </Card>
          </div>

          <div className="lg:col-span-4 space-y-6">
            {activeTab === "profile" && (
              <div className="space-y-6">
                <Card>
                  <CardHeader>
                    <CardTitle className="flex items-center gap-2">
                      <User className="w-5 h-5 text-blue-600" />
                      Profile Management
                    </CardTitle>
                    <CardDescription>Manage your profile and personal information</CardDescription>
                  </CardHeader>
                  <CardContent className="space-y-4">
                    <Link to={createPageUrl("UserProfile")}>
                      <div className="p-4 border-2 border-dashed rounded-lg hover:border-orange-500 hover:bg-orange-50/50 transition-all cursor-pointer group">
                        <div className="flex items-center gap-4">
                          <div className="w-12 h-12 bg-orange-100 rounded-xl flex items-center justify-center group-hover:bg-orange-200 transition-colors">
                            <User className="w-6 h-6 text-orange-600" />
                          </div>
                          <div className="flex-1">
                            <h3 className="font-semibold text-gray-900">Edit Profile</h3>
                            <p className="text-sm text-gray-500">Update personal details, photo, and bio</p>
                          </div>
                        </div>
                      </div>
                    </Link>

                    <Link to={createPageUrl("UserDashboard")}>
                      <div className="p-4 border-2 border-dashed rounded-lg hover:border-blue-500 hover:bg-blue-50/50 transition-all cursor-pointer group">
                        <div className="flex items-center gap-4">
                          <div className="w-12 h-12 bg-blue-100 rounded-xl flex items-center justify-center group-hover:bg-blue-200 transition-colors">
                            <BookOpen className="w-6 h-6 text-blue-600" />
                          </div>
                          <div className="flex-1">
                            <h3 className="font-semibold text-gray-900">My Dashboard</h3>
                            <p className="text-sm text-gray-500">View schemes, documents, and consultations</p>
                          </div>
                        </div>
                      </div>
                    </Link>

                    <Link to={createPageUrl("DocumentVault")}>
                      <div className="p-4 border-2 border-dashed rounded-lg hover:border-purple-500 hover:bg-purple-50/50 transition-all cursor-pointer group">
                        <div className="flex items-center gap-4">
                          <div className="w-12 h-12 bg-purple-100 rounded-xl flex items-center justify-center group-hover:bg-purple-200 transition-colors">
                            <Shield className="w-6 h-6 text-purple-600" />
                          </div>
                          <div className="flex-1">
                            <h3 className="font-semibold text-gray-900">Secure Vault</h3>
                            <p className="text-sm text-gray-500">Access encrypted documents</p>
                          </div>
                        </div>
                      </div>
                    </Link>
                  </CardContent>
                </Card>

                <Card>
                  <CardHeader>
                    <CardTitle>Account Statistics</CardTitle>
                  </CardHeader>
                  <CardContent>
                    <div className="grid grid-cols-2 gap-4">
                      <div className="p-4 bg-blue-50 rounded-lg text-center">
                        <p className="text-2xl font-bold text-blue-600">{user?.email?.split('@')[0]?.length || 0}</p>
                        <p className="text-xs text-gray-600">Username Length</p>
                      </div>
                      <div className="p-4 bg-green-50 rounded-lg text-center">
                        <p className="text-2xl font-bold text-green-600">
                          {Math.floor((new Date() - new Date(user?.created_date)) / (1000 * 60 * 60 * 24))}
                        </p>
                        <p className="text-xs text-gray-600">Days as Member</p>
                      </div>
                    </div>
                  </CardContent>
                </Card>
              </div>
            )}

            {activeTab === "notifications" && (
              <div className="space-y-6">
                <Card>
                  <CardHeader>
                    <CardTitle className="flex items-center gap-2">
                      <Bell className="w-5 h-5 text-orange-600" />
                      Notification Preferences
                    </CardTitle>
                    <CardDescription>Control what notifications you receive</CardDescription>
                  </CardHeader>
                  <CardContent className="space-y-6">
                    {[
                      { key: "email_notifications", title: "Email Notifications", desc: "Receive updates via email", icon: Mail },
                      { key: "scheme_alerts", title: "Scheme Alerts", desc: "New government schemes matching your profile", icon: AlertTriangle },
                      { key: "news_updates", title: "Government News", desc: "Latest policies and updates", icon: FileText },
                      { key: "job_alerts", title: "Job Alerts", desc: "New opportunities and deadlines", icon: Sparkles }
                    ].map((item, idx) => (
                      <div key={item.key}>
                        <div className="flex items-center justify-between py-3">
                          <div className="flex items-center gap-3">
                            <item.icon className="w-5 h-5 text-gray-400" />
                            <div className="space-y-1">
                              <Label className="text-base font-semibold">{item.title}</Label>
                              <p className="text-sm text-gray-500">{item.desc}</p>
                            </div>
                          </div>
                          <Switch
                            checked={settings[item.key]}
                            onCheckedChange={(checked) => setSettings({...settings, [item.key]: checked})}
                          />
                        </div>
                        {idx < 3 && <Separator />}
                      </div>
                    ))}

                    <Button onClick={saveSettings} disabled={isSaving} className="w-full bg-orange-600 hover:bg-orange-700 mt-4">
                      {isSaving ? "Saving..." : "Save Notification Preferences"}
                    </Button>
                  </CardContent>
                </Card>

                <Card>
                  <CardHeader>
                    <CardTitle>Notification Channels</CardTitle>
                    <CardDescription>Choose how you want to be notified</CardDescription>
                  </CardHeader>
                  <CardContent className="space-y-4">
                    <div className="flex items-center justify-between">
                      <div>
                        <Label className="text-base font-semibold">Push Notifications</Label>
                        <p className="text-sm text-gray-500">Browser push notifications</p>
                      </div>
                      <Switch defaultChecked />
                    </div>
                    <Separator />
                    <div className="flex items-center justify-between">
                      <div>
                        <Label className="text-base font-semibold">SMS Alerts</Label>
                        <p className="text-sm text-gray-500">Critical updates via SMS</p>
                      </div>
                      <Switch />
                    </div>
                    <Separator />
                    <div className="flex items-center justify-between">
                      <div>
                        <Label className="text-base font-semibold">Digest Email</Label>
                        <p className="text-sm text-gray-500">Weekly summary email</p>
                      </div>
                      <Switch defaultChecked />
                    </div>
                  </CardContent>
                </Card>
              </div>
            )}

            {activeTab === "security" && (
              <div className="space-y-6">
                <Card>
                  <CardHeader>
                    <CardTitle className="flex items-center gap-2">
                      <Lock className="w-5 h-5 text-red-600" />
                      Security Settings
                    </CardTitle>
                    <CardDescription>Protect your account with advanced security features</CardDescription>
                  </CardHeader>
                  <CardContent className="space-y-6">
                    <div className="p-4 bg-green-50 border-2 border-green-200 rounded-lg">
                      <div className="flex items-center gap-3 text-green-800 mb-2">
                        <ShieldCheck className="w-5 h-5" />
                        <h4 className="font-semibold">Account Secured</h4>
                      </div>
                      <p className="text-sm text-green-700">Protected with 256-bit AES encryption</p>
                    </div>

                    {/* Two-Factor Authentication */}
                    <div className={`p-4 border-2 rounded-lg ${settings.two_factor_verified ? 'bg-green-50 border-green-200' : 'bg-blue-50 border-blue-200'}`}>
                      <div className="flex items-center justify-between mb-3">
                        <div className="flex items-center gap-3">
                          <Smartphone className="w-5 h-5 text-blue-600" />
                          <div>
                            <p className="font-semibold flex items-center gap-2">
                              Two-Factor Authentication
                              {settings.two_factor_verified && <Check className="w-4 h-4 text-green-600" />}
                            </p>
                            <p className="text-xs text-gray-600">Email verification for extra security</p>
                            {settings.two_factor_verified && (
                              <p className="text-xs text-green-600 font-semibold mt-1">âœ… Verified and Active</p>
                            )}
                          </div>
                        </div>
                        <Switch
                          checked={settings.two_factor_enabled}
                          onCheckedChange={(v) => {
                            setSettings({...settings, two_factor_enabled: v});
                            if (v) handleEnable2FA();
                          }}
                        />
                      </div>
                    </div>

                    {/* Biometric Authentication */}
                    <div className={`p-4 border-2 rounded-lg ${settings.biometric_enabled ? 'bg-purple-50 border-purple-200' : 'bg-gray-50 border-gray-200'}`}>
                      <div className="flex items-center justify-between">
                        <div className="flex items-center gap-3">
                          <Fingerprint className="w-5 h-5 text-purple-600" />
                          <div>
                            <p className="font-semibold flex items-center gap-2">
                              Biometric Authentication
                              {settings.biometric_enabled && <Check className="w-4 h-4 text-green-600" />}
                            </p>
                            <p className="text-xs text-gray-600">Fingerprint or face recognition</p>
                            {settings.biometric_enabled && (
                              <p className="text-xs text-green-600 font-semibold mt-1">ðŸ”’ Active</p>
                            )}
                          </div>
                        </div>
                        <Switch
                          checked={settings.biometric_enabled}
                          onCheckedChange={handleEnableBiometric}
                        />
                      </div>
                    </div>

                    {/* App Lock */}
                    <div className={`p-4 border-2 rounded-lg ${settings.app_lock_enabled ? 'bg-orange-50 border-orange-200' : 'bg-gray-50 border-gray-200'}`}>
                      <div className="flex items-center justify-between">
                        <div className="flex items-center gap-3">
                          <Lock className="w-5 h-5 text-orange-600" />
                          <div>
                            <p className="font-semibold flex items-center gap-2">
                              App Lock
                              {settings.app_lock_enabled && <Check className="w-4 h-4 text-green-600" />}
                            </p>
                            <p className="text-xs text-gray-600">Require authentication to open app</p>
                          </div>
                        </div>
                        <Switch
                          checked={settings.app_lock_enabled}
                          onCheckedChange={(v) => {
                            setSettings({...settings, app_lock_enabled: v});
                            if (v) {
                              toast.success("App Lock enabled - will activate on next session");
                            }
                          }}
                        />
                      </div>
                    </div>

                    <Dialog>
                      <DialogTrigger asChild>
                        <div className="p-4 border-2 border-dashed rounded-lg hover:border-orange-500 hover:bg-orange-50/50 transition-all cursor-pointer group">
                          <div className="flex items-center gap-4">
                            <div className="w-12 h-12 bg-orange-100 rounded-xl flex items-center justify-center group-hover:bg-orange-200">
                              <Key className="w-6 h-6 text-orange-600" />
                            </div>
                            <div className="flex-1">
                              <h3 className="font-semibold">Change Password</h3>
                              <p className="text-sm text-gray-500">Update your account password</p>
                            </div>
                          </div>
                        </div>
                      </DialogTrigger>
                      <DialogContent>
                        <DialogHeader>
                          <DialogTitle>Change Password</DialogTitle>
                          <DialogDescription>Enter your current and new password</DialogDescription>
                        </DialogHeader>
                        <div className="space-y-4 pt-4">
                          <div>
                            <Label>Current Password</Label>
                            <Input type="password" placeholder="Enter current password" />
                          </div>
                          <div>
                            <Label>New Password</Label>
                            <Input type="password" placeholder="Enter new password" />
                          </div>
                          <div>
                            <Label>Confirm New Password</Label>
                            <Input type="password" placeholder="Confirm new password" />
                          </div>
                          <Button className="w-full bg-orange-600 hover:bg-orange-700">
                            Update Password
                          </Button>
                        </div>
                      </DialogContent>
                    </Dialog>

                    <Button onClick={saveSettings} disabled={isSaving} className="w-full bg-red-600 hover:bg-red-700">
                      {isSaving ? "Saving..." : "Save Security Settings"}
                    </Button>
                  </CardContent>
                </Card>
              </div>
            )}

            {activeTab === "privacy" && (
              <Card>
                <CardHeader>
                  <CardTitle className="flex items-center gap-2">
                    <Shield className="w-5 h-5 text-green-600" />
                    Privacy & Data Security
                  </CardTitle>
                  <CardDescription>Control your data and privacy preferences</CardDescription>
                </CardHeader>
                <CardContent className="space-y-6">
                  <div className="p-4 bg-green-50 border-2 border-green-200 rounded-lg">
                    <div className="flex items-center gap-3 mb-3">
                      <FileKey className="w-6 h-6 text-green-600" />
                      <h4 className="font-semibold text-green-900">End-to-End Encryption</h4>
                    </div>
                    <ul className="text-sm text-green-800 space-y-1">
                      <li>âœ“ All documents encrypted with 256-bit AES</li>
                      <li>âœ“ Messages and chats are private</li>
                      <li>âœ“ Your data never leaves India</li>
                      <li>âœ“ GDPR & ISO 27001 compliant</li>
                    </ul>
                  </div>

                  {[
                    { key: "data_collection", title: "Usage Analytics", desc: "Anonymous usage data to improve experience", icon: Database },
                    { key: "analytics", title: "Performance Analytics", desc: "Track app performance", icon: Eye },
                    { key: "backup_enabled", title: "Auto Backup", desc: "Automatic secure cloud backup", icon: Shield },
                    { key: "cookies", title: "Essential Cookies", desc: "Required for app functionality", icon: FileText }
                  ].map((item, idx) => (
                    <div key={item.key}>
                      <div className="flex items-center justify-between py-3">
                        <div className="flex items-center gap-3">
                          <item.icon className="w-5 h-5 text-gray-400" />
                          <div className="space-y-1">
                            <Label className="text-base font-semibold">{item.title}</Label>
                            <p className="text-sm text-gray-500">{item.desc}</p>
                          </div>
                        </div>
                        <Switch
                          checked={settings[item.key]}
                          onCheckedChange={(checked) => setSettings({...settings, [item.key]: checked})}
                        />
                      </div>
                      {idx < 3 && <Separator />}
                    </div>
                  ))}

                  <Button onClick={saveSettings} disabled={isSaving} className="w-full bg-green-600 hover:bg-green-700">
                    {isSaving ? "Saving..." : "Save Privacy Settings"}
                  </Button>
                </CardContent>
              </Card>
            )}

            {activeTab === "ai" && (
              <div className="space-y-6">
                <Card>
                  <CardHeader>
                    <CardTitle className="flex items-center gap-2">
                      <Sparkles className="w-5 h-5 text-purple-600" />
                      AI Assistant Settings
                    </CardTitle>
                    <CardDescription>Configure AI features and privacy preferences</CardDescription>
                  </CardHeader>
                  <CardContent className="space-y-6">
                    {[
                      { key: "ai_features", title: "Enable AI Features", desc: "Use AI assistants and smart tools", icon: Bot },
                      { key: "ai_suggestions", title: "AI Suggestions", desc: "Get personalized recommendations", icon: Sparkles },
                      { key: "ai_history", title: "Save Chat History", desc: "Store conversations for reference", icon: FileText }
                    ].map((item, idx) => (
                      <div key={item.key}>
                        <div className="flex items-center justify-between py-3">
                          <div className="flex items-center gap-3">
                            <item.icon className="w-5 h-5 text-purple-400" />
                            <div className="space-y-1">
                              <Label className="text-base font-semibold">{item.title}</Label>
                              <p className="text-sm text-gray-500">{item.desc}</p>
                            </div>
                          </div>
                          <Switch
                            checked={settings[item.key]}
                            onCheckedChange={(checked) => setSettings({...settings, [item.key]: checked})}
                          />
                        </div>
                        {idx < 2 && <Separator />}
                      </div>
                    ))}

                    <Button onClick={saveSettings} disabled={isSaving} className="w-full bg-purple-600 hover:bg-purple-700">
                      {isSaving ? "Saving..." : "Save AI Settings"}
                    </Button>
                  </CardContent>
                </Card>

                <Card>
                  <CardHeader>
                    <CardTitle>AI Model Preferences</CardTitle>
                    <CardDescription>Advanced AI configuration</CardDescription>
                  </CardHeader>
                  <CardContent className="space-y-4">
                    <div>
                      <Label>Response Style</Label>
                      <select
                        defaultValue="balanced"
                        className="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-purple-500"
                      >
                        <option value="concise">Concise & Quick</option>
                        <option value="balanced">Balanced</option>
                        <option value="detailed">Detailed & Comprehensive</option>
                      </select>
                    </div>
                    <Separator />
                    <div>
                      <Label>AI Language Preference</Label>
                      <select
                        defaultValue="auto"
                        className="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-purple-500"
                      >
                        <option value="auto">Auto-detect</option>
                        <option value="english">English</option>
                        <option value="hindi">Hindi</option>
                        <option value="gujarati">Gujarati</option>
                      </select>
                    </div>
                    <Separator />
                    <div className="flex items-center justify-between">
                      <div>
                        <Label className="text-base font-semibold">Context Awareness</Label>
                        <p className="text-sm text-gray-500">Use previous chats for better responses</p>
                      </div>
                      <Switch defaultChecked />
                    </div>
                  </CardContent>
                </Card>
              </div>
            )}

            {activeTab === "about" && (
              <Card>
                <CardHeader>
                  <CardTitle className="flex items-center gap-2">
                    <Info className="w-5 h-5 text-gray-600" />
                    About Nyay Mitra
                  </CardTitle>
                  <CardDescription>Legal & Government Helpdesk Platform</CardDescription>
                </CardHeader>
                <CardContent className="space-y-6">
                  <div>
                    <h4 className="font-semibold text-lg mb-2">Version 3.5.0</h4>
                    <p className="text-sm text-gray-500">Released: January 2025</p>
                  </div>
                  <Separator />
                  <div>
                    <h4 className="font-semibold mb-3 flex items-center gap-2">
                      <Sparkles className="w-5 h-5 text-purple-600" />
                      Latest Updates (v3.5)
                    </h4>
                    <div className="space-y-3 text-sm">
                      {[
                        { icon: Shield, text: "ðŸ” Working App Lock with secure credentials", color: "text-green-600" },
                        { icon: Smartphone, text: "ðŸ“± Functional 2FA with email verification", color: "text-blue-600" },
                        { icon: Fingerprint, text: "ðŸ‘† Fixed Biometric Authentication", color: "text-purple-600" },
                        { icon: FileKey, text: "ðŸ”’ Enhanced Vault Security & Preview", color: "text-indigo-600" },
                        { icon: Bot, text: "ðŸ’¬ AI Chat History auto-saves properly", color: "text-orange-600" },
                        { icon: Eye, text: "ðŸ“š Legal Tutorial Videos Only", color: "text-red-600" }
                      ].map((item, idx) => (
                        <div key={idx} className="flex gap-3">
                          <item.icon className={`w-5 h-5 ${item.color} mt-0.5`} />
                          <span>{item.text}</span>
                        </div>
                      ))}
                    </div>
                  </div>
                  <Separator />
                  <div>
                    <h4 className="font-semibold mb-3">Changelog - Previous Versions</h4>
                    <div className="space-y-2 text-sm">
                      <div className="p-3 bg-gray-50 rounded">
                        <p className="font-medium">v3.0.0 - January 2025</p>
                        <p className="text-gray-600">Security enhancements, biometric lock, 2FA</p>
                      </div>
                      <div className="p-3 bg-gray-50 rounded">
                        <p className="font-medium">v2.5.0 - December 2024</p>
                        <p className="text-gray-600">AI personalized scheme matching, calculators</p>
                      </div>
                      <div className="p-3 bg-gray-50 rounded">
                        <p className="font-medium">v2.0.0 - November 2024</p>
                        <p className="text-gray-600">RTI Wizard, Form Filler, Video Library</p>
                      </div>
                    </div>
                  </div>
                  <Separator />
                  <div className="text-center pt-4">
                    <p className="text-sm text-gray-500">Â© 2025 Nyay Mitra. All Rights Reserved.</p>
                    <p className="text-xs text-gray-400 mt-2">Empowering 50,000+ Indian citizens</p>
                  </div>

                  <Dialog open={showFeedbackDialog} onOpenChange={setShowFeedbackDialog}>
                    <DialogTrigger asChild>
                      <Button variant="outline" className="w-full">
                        <MessageSquare className="w-4 h-4 mr-2" />
                        Send Feedback
                      </Button>
                    </DialogTrigger>
                    <DialogContent>
                      <DialogHeader>
                        <DialogTitle>Send Feedback</DialogTitle>
                        <DialogDescription>We'd love to hear your thoughts!</DialogDescription>
                      </DialogHeader>
                      <div className="space-y-4 pt-4">
                        <Textarea
                          value={feedback}
                          onChange={(e) => setFeedback(e.target.value)}
                          placeholder="Share your feedback, suggestions, or report issues..."
                          rows={5}
                        />
                        <Button onClick={handleSendFeedback} className="w-full bg-green-600 hover:bg-green-700">
                          <Send className="w-4 h-4 mr-2" />
                          Send Feedback
                        </Button>
                      </div>
                    </DialogContent>
                  </Dialog>
                </CardContent>
              </Card>
            )}
          </div>
        </div>
      </div>

      {/* 2FA Verification Dialog */}
      <Dialog open={show2FADialog} onOpenChange={setShow2FADialog}>
        <DialogContent>
          <DialogHeader>
            <DialogTitle>Verify Two-Factor Authentication</DialogTitle>
            <DialogDescription>Enter the 6-digit code sent to {user.email}</DialogDescription>
          </DialogHeader>
          <div className="space-y-4 pt-4">
            <div>
              <Label>Verification Code</Label>
              <Input
                type="text"
                maxLength={6}
                value={twoFactorCode}
                onChange={(e) => setTwoFactorCode(e.target.value.replace(/\D/g, ''))}
                placeholder="Enter 6-digit code"
                className="text-center text-2xl tracking-widest"
                autoFocus
              />
            </div>
            <Button onClick={verify2FACode} className="w-full bg-blue-600 hover:bg-blue-700">
              Verify & Enable 2FA
            </Button>
            <p className="text-xs text-center text-gray-500">Code valid for 10 minutes</p>
          </div>
        </DialogContent>
      </Dialog>
    </div>
  );
}