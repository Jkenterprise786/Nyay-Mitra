import React, { useState, useEffect } from "react";
import { base44 } from "@/api/base44Client";
import { Scale, Shield, Sparkles, BookOpen, FileSearch, Gavel, Users, Zap, Brain } from "lucide-react";
import { Card, CardContent, CardHeader, CardTitle } from "@/components/ui/card";
import { Tabs, TabsList, TabsTrigger, TabsContent } from "@/components/ui/tabs";
import { Badge } from "@/components/ui/badge";
import ChatInterface from "../components/ai/ChatInterface";
import AIDocumentAnalyzer from "../components/ai/AIDocumentAnalyzer";

export default function AILegalPro() {
  const [user, setUser] = useState(null);
  const [activeTab, setActiveTab] = useState("chat");

  useEffect(() => {
    const loadUser = async () => {
      try {
        const currentUser = await base44.auth.me();
        setUser(currentUser);
      } catch (error) {
        console.log("User not logged in");
      }
    };
    loadUser();
  }, []);

  const systemPrompt = `You are AI Legal Pro, an advanced legal information assistant for Indian citizens. You specialize in:
- Explaining legal concepts in simple language
- Providing information about Indian laws and acts
- Helping users understand their legal rights
- Guiding users through legal processes
- Explaining legal documents and terms
- Drafting legal notices and applications
- Case law research and citations
- Court procedures and filing requirements

You have deep knowledge of:
- Indian Constitution
- Criminal law (IPC, CrPC, BNS)
- Civil law (CPC, Contract Act, etc.)
- Consumer Protection Act 2019
- Family law (Hindu Marriage Act, Special Marriage Act)
- Property law (Transfer of Property Act, Registration Act)
- Labor law (Industrial Disputes Act, Minimum Wages Act)
- Cyber law (IT Act 2000)
- Environmental law
- Tax law (Income Tax Act, GST)

Advanced Capabilities:
1. Legal Document Drafting: Can help draft legal notices, affidavits, petitions, applications
2. Case Analysis: Analyze case facts and suggest potential legal remedies
3. Statute Interpretation: Explain sections of acts in simple language
4. Precedent Research: Provide information about landmark judgments
5. Legal Strategy: Suggest approaches for common legal situations
6. Rights Education: Educate users about their constitutional and legal rights

IMPORTANT DISCLAIMERS:
1. You provide LEGAL INFORMATION, not LEGAL ADVICE
2. You always remind users to consult a qualified lawyer for advice specific to their case
3. You never predict case outcomes or provide opinions on specific legal matters
4. You cite relevant sections of law when applicable
5. You clarify when a matter requires professional legal representation

Communication Style:
- Use simple, non-jargon language
- Provide examples and analogies
- Structure answers with clear headings
- Cite specific sections and acts
- Acknowledge complexity and limitations
- Always recommend professional consultation for serious matters

Be precise, accurate, and always err on the side of caution when discussing legal matters.`;

  const capabilities = [
    {
      icon: BookOpen,
      title: "Legal Knowledge Base",
      desc: "Deep knowledge of Indian laws, acts, and regulations",
      color: "text-blue-600"
    },
    {
      icon: FileSearch,
      title: "Document Analysis",
      desc: "Analyze and review legal documents for issues",
      color: "text-purple-600"
    },
    {
      icon: Gavel,
      title: "Case Research",
      desc: "Information about case laws and precedents",
      color: "text-green-600"
    },
    {
      icon: Users,
      title: "Rights Education",
      desc: "Understand your legal and constitutional rights",
      color: "text-orange-600"
    },
    {
      icon: Zap,
      title: "Quick Answers",
      desc: "Fast, accurate responses to legal queries",
      color: "text-red-600"
    },
    {
      icon: Brain,
      title: "Legal Strategy",
      desc: "Suggestions for common legal situations",
      color: "text-indigo-600"
    }
  ];

  return (
    <div className="min-h-screen bg-gradient-to-br from-gray-50 to-gray-100">
      {/* Header with SVG Logo */}
      <div className="bg-gradient-to-br from-green-600 to-emerald-700 text-white shadow-xl">
        <div className="max-w-7xl mx-auto px-4 py-12">
          <div className="flex items-center gap-4 mb-6">
            {/* AI Legal Pro SVG Logo */}
            <svg className="w-16 h-16" viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg">
              <defs>
                <linearGradient id="legalGradient" x1="0%" y1="0%" x2="100%" y2="100%">
                  <stop offset="0%" style={{stopColor: '#10B981', stopOpacity: 1}} />
                  <stop offset="100%" style={{stopColor: '#059669', stopOpacity: 1}} />
                </linearGradient>
              </defs>
              <path d="M50 20 L35 50 L50 45 L65 50 Z" fill="url(#legalGradient)"/>
              <rect x="47" y="50" width="6" height="25" fill="url(#legalGradient)"/>
              <circle cx="50" cy="50" r="28" fill="none" stroke="white" strokeWidth="3" opacity="0.3"/>
              <circle cx="35" cy="30" r="4" fill="white"/>
              <circle cx="65" cy="30" r="4" fill="white"/>
              <path d="M 30 75 L 70 75" stroke="url(#legalGradient)" strokeWidth="4"/>
            </svg>
            <div>
              <h1 className="text-3xl md:text-4xl font-bold flex items-center gap-2">
                <Sparkles className="w-8 h-8" />
                AI Legal Pro
              </h1>
              <p className="text-green-100 mt-1">Advanced AI legal information & document analysis with chat history</p>
            </div>
          </div>

          <div className="grid md:grid-cols-3 gap-4 mb-6">
            {capabilities.slice(0, 3).map((cap, i) => (
              <div key={i} className="bg-white/10 backdrop-blur-sm rounded-xl p-4 border border-white/20">
                <div className="flex items-start gap-3">
                  <div className="w-10 h-10 bg-white/20 rounded-lg flex items-center justify-center">
                    <cap.icon className="w-5 h-5" />
                  </div>
                  <div>
                    <h3 className="font-semibold text-sm">{cap.title}</h3>
                    <p className="text-xs text-green-100 mt-1">{cap.desc}</p>
                  </div>
                </div>
              </div>
            ))}
          </div>

          <div className="bg-yellow-400/20 backdrop-blur-sm rounded-xl p-4 border border-yellow-300/30">
            <div className="flex gap-2">
              <Shield className="w-5 h-5 text-yellow-200 flex-shrink-0 mt-0.5" />
              <p className="text-yellow-50 text-sm">
                <strong>Important:</strong> I provide legal INFORMATION only, not legal ADVICE. For advice specific to your situation, please consult a qualified lawyer.
              </p>
            </div>
          </div>
        </div>
      </div>

      <div className="max-w-7xl mx-auto px-4 py-8">
        <Tabs value={activeTab} onValueChange={setActiveTab} className="space-y-6">
          <TabsList className="grid w-full grid-cols-2 lg:w-auto">
            <TabsTrigger value="chat" className="gap-2">
              <Scale className="w-4 h-4" />
              Legal Chat
            </TabsTrigger>
            <TabsTrigger value="document" className="gap-2">
              <FileSearch className="w-4 h-4" />
              Document Analyzer
            </TabsTrigger>
          </TabsList>

          <TabsContent value="chat" className="space-y-6">
            <Card className="h-[calc(100vh-450px)] min-h-[500px] overflow-hidden shadow-xl">
              <ChatInterface
                assistantType="Legal"
                assistantName="AI Legal Pro"
                systemPrompt={systemPrompt}
                user={user}
              />
            </Card>

            <Card>
              <CardHeader>
                <CardTitle className="text-lg">What I Can Help You With</CardTitle>
              </CardHeader>
              <CardContent>
                <div className="grid md:grid-cols-2 lg:grid-cols-3 gap-4">
                  {capabilities.map((cap, i) => (
                    <div key={i} className="flex items-start gap-3 p-3 bg-gray-50 rounded-lg">
                      <div className={`${cap.color}`}>
                        <cap.icon className="w-5 h-5" />
                      </div>
                      <div>
                        <h4 className="font-medium text-sm">{cap.title}</h4>
                        <p className="text-xs text-gray-600 mt-1">{cap.desc}</p>
                      </div>
                    </div>
                  ))}
                </div>
              </CardContent>
            </Card>

            <div className="grid md:grid-cols-3 gap-4">
              <Card className="bg-gradient-to-br from-blue-50 to-blue-100 border-blue-200">
                <CardContent className="p-6">
                  <h3 className="font-semibold text-blue-900 mb-2">Ask Legal Questions</h3>
                  <p className="text-sm text-blue-800">Get instant answers about laws, rights, and procedures</p>
                </CardContent>
              </Card>
              <Card className="bg-gradient-to-br from-purple-50 to-purple-100 border-purple-200">
                <CardContent className="p-6">
                  <h3 className="font-semibold text-purple-900 mb-2">Document Help</h3>
                  <p className="text-sm text-purple-800">Understand legal documents and get drafting assistance</p>
                </CardContent>
              </Card>
              <Card className="bg-gradient-to-br from-green-50 to-green-100 border-green-200">
                <CardContent className="p-6">
                  <h3 className="font-semibold text-green-900 mb-2">Case Guidance</h3>
                  <p className="text-sm text-green-800">Learn about similar cases and possible approaches</p>
                </CardContent>
              </Card>
            </div>
          </TabsContent>

          <TabsContent value="document">
            <AIDocumentAnalyzer user={user} />
          </TabsContent>
        </Tabs>
      </div>
    </div>
  );
}